<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>결제하기 - 청담 살롱</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            margin: 40px auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            padding: 40px 30px;
        }

        .package-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }

        .package-name {
            font-size: 24px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 15px;
        }

        .package-price {
            font-size: 36px;
            font-weight: 800;
            color: #212529;
            margin-bottom: 20px;
        }

        .package-price span {
            font-size: 18px;
            font-weight: 400;
            color: #6c757d;
        }

        .package-features {
            list-style: none;
            margin-top: 20px;
        }

        .package-features li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            color: #495057;
            font-size: 14px;
        }

        .package-features li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #212529;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 14px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .required {
            color: #dc3545;
        }

        .payment-info {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
            font-size: 13px;
            color: #856404;
        }

        .payment-info strong {
            display: block;
            margin-bottom: 8px;
        }

        .btn-payment {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-payment:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn-payment:active {
            transform: translateY(0);
        }

        .btn-back {
            display: block;
            text-align: center;
            margin-top: 20px;
            color: #6c757d;
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s;
        }

        .btn-back:hover {
            color: #667eea;
        }

        .card-restriction {
            background: #f8d7da;
            border: 1px solid #f5c2c7;
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
            font-size: 12px;
            color: #842029;
        }

        @media (max-width: 768px) {
            .container {
                margin: 20px auto;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .package-price {
                font-size: 32px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>청담 살롱</h1>
            <p>하이엔드 점성술 리포트 결제</p>
        </div>

        <div class="content">
            <div class="package-info" id="packageInfo">
                <!-- JavaScript로 동적 생성 -->
            </div>

            <form id="paymentForm">
                <div class="form-group">
                    <label>이름 <span class="required">*</span></label>
                    <input type="text" id="buyerName" name="buyerName" placeholder="홍길동" required>
                </div>

                <div class="form-group">
                    <label>이메일 <span class="required">*</span></label>
                    <input type="email" id="buyerEmail" name="buyerEmail" placeholder="example@email.com" required>
                </div>

                <div class="form-group">
                    <label>휴대폰 번호 <span class="required">*</span></label>
                    <input type="tel" id="buyerPhone" name="buyerPhone" placeholder="010-1234-5678" required>
                </div>

                <div class="payment-info">
                    <strong>⚠️ 카드사 안내</strong>
                    점성술 서비스 특성상 <strong>현대카드, 삼성카드는 사용이 불가</strong>합니다.
                    <div class="card-restriction">
                        <strong>사용 가능:</strong> BC카드, 신한카드, 국민카드, 하나카드, 롯데카드 등<br>
                        <strong>사용 불가:</strong> 현대카드, 삼성카드
                    </div>
                </div>

                <button type="submit" class="btn-payment">
                    결제하기
                </button>
            </form>

            <a href="/" class="btn-back">← 메인으로 돌아가기</a>
        </div>
    </div>

    <!-- KG이니시스 결제 스크립트 -->
    <script src="https://stdpay.inicis.com/stdjs/INIStdPay.js" charset="UTF-8"></script>
    
    <script>
        // 패키지 정보
        const packages = {
            'light': {
                name: '라이트 리포트',
                price: 29900,
                features: [
                    '개인 차트 기반 기본 성향 요약',
                    '현재 1년 간 주요 흐름 요약',
                    '연애 / 관계 패턴 핵심 포인트',
                    'PDF 약 8~10p 내외'
                ]
            },
            'standard': {
                name: '스탠다드 리포트',
                price: 49900,
                features: [
                    '라이트 리포트 전 내용 포함',
                    '연애/결혼 & 커리어 축 심층 분석',
                    '현재 고민 2개까지 집중 분석',
                    '월별 키 타이밍 · 주의 구간 정리',
                    'PDF 약 14~18p 내외'
                ]
            },
            'premium': {
                name: '프리미엄 리포트',
                price: 79900,
                features: [
                    '스탠다드 전 내용 포함',
                    '관계 / 커리어 중 한 축 깊게 확장',
                    '당신만의 사용설명서 추가',
                    '맞춤 문장 템플릿 포함',
                    'PDF 약 18~22p 내외'
                ]
            }
        };

        // URL에서 패키지 정보 가져오기
        const urlParams = new URLSearchParams(window.location.search);
        const packageType = urlParams.get('package') || 'standard';
        const selectedPackage = packages[packageType];

        // 패키지 정보 표시
        if (selectedPackage) {
            const packageInfoHTML = `
                <div class="package-name">${selectedPackage.name}</div>
                <div class="package-price">${selectedPackage.price.toLocaleString()}원 <span>/ 1회</span></div>
                <ul class="package-features">
                    ${selectedPackage.features.map(feature => `<li>${feature}</li>`).join('')}
                </ul>
            `;
            document.getElementById('packageInfo').innerHTML = packageInfoHTML;
        }

        // KG이니시스 설정
        const INICIS_CONFIG = {
            mid: 'MOI5322258',  // 상점아이디
            signKey: 'ckZFdE9SWWpIN0lnUHlZMU9lUzh6UT09',  // 웹결제 signkey
            channelKey: 'channel-key-6130cdbf-0645-4f43-8b88-b435c8d6f9ad'
        };

        // 결제 폼 제출
        document.getElementById('paymentForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const buyerName = document.getElementById('buyerName').value;
            const buyerEmail = document.getElementById('buyerEmail').value;
            const buyerPhone = document.getElementById('buyerPhone').value;

            // 전화번호 형식 검증
            const phoneRegex = /^01[0-9]-?[0-9]{3,4}-?[0-9]{4}$/;
            if (!phoneRegex.test(buyerPhone)) {
                alert('올바른 휴대폰 번호를 입력해주세요.');
                return;
            }

            // 주문번호 생성 (예: ORDER20250101123456)
            const orderNumber = 'ORDER' + new Date().getTime();

            // 결제 요청
            requestPayment(orderNumber, buyerName, buyerEmail, buyerPhone);
        });

        // KG이니시스 결제 요청
        function requestPayment(orderNumber, buyerName, buyerEmail, buyerPhone) {
            const currentUrl = window.location.origin;
            
            INIStdPay.pay({
                // 필수 파라미터
                PayMethod: 'Card',  // 결제수단: 신용카드
                MID: INICIS_CONFIG.mid,
                Moid: orderNumber,
                Amt: selectedPackage.price,
                GoodsName: selectedPackage.name,
                BuyerName: buyerName,
                BuyerEmail: buyerEmail,
                BuyerTel: buyerPhone.replace(/-/g, ''),
                
                // 결과 수신 URL
                ReturnUrl: currentUrl + '/payment-result.html',
                ResultYN: 'Y',  // 결과창 표시 여부
                
                // 옵션 파라미터
                Currency: 'WON',
                Charset: 'UTF-8',
                CardQuota: '00:03',  // 할부: 일시불, 3개월 (BC카드는 3개월까지만)
                
                // 안심클릭
                acceptmethod: 'below1000',  // 1,000원 이하 안심클릭 skip
                
                // 카드사 제한 (현대, 삼성 제외)
                useescrow: 'N',
                
                // 성공/실패 콜백
                onSuccess: function(response) {
                    // 결제 성공
                    window.location.href = currentUrl + '/payment-success.html?orderNumber=' + orderNumber;
                },
                onError: function(error) {
                    // 결제 실패
                    alert('결제 중 오류가 발생했습니다: ' + error.message);
                    window.location.href = currentUrl + '/payment-fail.html?reason=' + encodeURIComponent(error.message);
                }
            });
        }

        // 전화번호 자동 하이픈
        document.getElementById('buyerPhone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^0-9]/g, '');
            if (value.length > 3 && value.length <= 7) {
                value = value.slice(0, 3) + '-' + value.slice(3);
            } else if (value.length > 7) {
                value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
            }
            e.target.value = value;
        });
    </script>
</body>
</html>
